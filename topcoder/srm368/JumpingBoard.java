package topcoder;
public class JumpingBoard {
	String[] b;
	int hei, wid;
	int[] dx = new int[]{1, 0, -1, 0};
	int[] dy = new int[]{0, 1, 0, -1};
	boolean[][] mark;
	boolean[][] gray;
	int[][] ans;
	
	public int maxJumps(String[] board) {
		b = board;
		hei = board.length;
		wid = board[0].length();
		mark = new boolean[hei][wid];
		gray = new boolean[hei][wid];
		ans = new int[hei][wid];
		return dfs(0, 0);
	}

	private int dfs(int i, int j) {
		if (b[i].charAt(j) == 'H')
			return 0;
		if (mark[i][j])
			return ans[i][j];
		mark[i][j] = true;
		gray[i][j] = true;
		int L = b[i].charAt(j) - '0';
		for (int d = 0; d < 4; d++) {
			int ii = i + dx[d] * L;
			int jj = j + dy[d] * L;
			if (ii < 0 || ii >= hei || jj < 0 || jj >= wid) {
				ans[i][j] = Math.max(ans[i][j], 1);
				continue;
			}
			if (gray[ii][jj])
				return -1;
			int cur = dfs(ii, jj);
			if (cur == -1)
				return -1;
			ans[i][j] = Math.max(ans[i][j], 1 + cur);
		}
		gray[i][j] = false;
		return ans[i][j];
	}
	
	public static void main(String[] args) {
		new JumpingBoard().maxJumps(new String[]{"1HHHHH2HHHH512HHHHHHHHHHHHH6HH9HH1H8HH31HHHHHHHHHH", "6HHHHH5H5HHHHHHHH3HH56137H24H71HH44HHHHHHHHHHHHHHH", "HHH4HH81HH7H9HHH7HHH8H63HHHHHHHHHHHHHHHHHHHHHHHH6H", "HHHHHHH4HH4HH55HHH76HHHHH8HHHHHHH1HHHHHHH16HHHHHHH", "HHHHHHHHHH1HHH4H2HHHHHH7HHHHHHHHH7HHHHHHHHHH5H8H9H", "HHHHHHHHHHHHHHHHHHH214HHH3HHHHHHHH9H22H938HH19H617", "7HHHHH6H6HHHHHHHHHHH3HHHHHHHHHHHHHH4HHH91H2HHHHH4H", "HHHH21H16HHH7H9HHHHHHHHHHHHHHHHHHH6HHHHH2H3H3HHH4H", "HHHHHHHH95HHHH7HH3H77H59H22HHHHH2HHHHHHHH5HHHHHH1H", "HHHH8HHHHHHH9HHHHHHH5HHHHHH7H6HHHH5H3HHHH9473H5HHH", "HHHH9H2HHHHHH6HHHHH2HHHHHH9HHHHH8HHHHHHH421HHHHHHH", "HHHHHHHHHH9H4HHHHH4HHHHHHH8HHHHHH3HH5HHH6HH3HHHHHH", "HHHHHHHH9HHH3H8HH1HH6HHHHHHHHHHH9HH31HHHHHHHHH5H81", "6HHHHHHHHHHHHHHHH8HH8H2HHHH4HHHHHHHHH2H4HH53HHHH7H", "HHHHHHHH6HHH2H7H88HH3HHHHH31HHHH5HH8HHHH9H8H9HHHH7", "HHHHHHHHH6HH7H1HHH9H9H5HHHHHH7HH1HHHHHH7HHHHHHHHHH", "HHHHHHHHH8HHHHHHHHHHHHHH7H8HHHH5HH9H6HHHHH35H7HHHH", "HHHHHHHHHHHHHHHHHHHHHHHH1HHHHHHHHHH1HHHHH4H8HH3HHH", "HHHHHHHH2H7HHHHHHH6H7HHH7H419HHHHHH8HHHHH1H9HHHHHH", "3HHHHHH4HHH3HHHHH8HHHHHHH9HHHHHHHHHHHHHHHHHHHHHHHH", "HHHHHHH1H4HHHHHHHHHH8H2H1HHHHHHHHHH6HHHHHHHHHHHHHH", "7HHHHHH2H4HHHHHH717HHHHH62HHHHH31281HH7H451HHH6HHH", "1HHHHHHHHH642HH9H4HHHHHH2H8H3HHHHHHHHHHHHH9H8HHHHH", "HHHHHHH9HHHH2H7H645H5H4H5833H9H4HHHHH2H7HHHHH8HHHH", "HHHHHHHHHHHHHHHHHHHH3HH273HH6HHHH72H3HHH3HH12HHHHH", "HHHHHHHHH5HHHHHHHHHHHH9H5H7H6HHH9HHH87HH85HHHHHHHH", "HHHHHHHHHHH8HHHHH9H9HHHHHH6HHHH3HHHHHH5H9HHHHHHHHH", "HH6HHHHH9H3918HHHHH5213HHH6H5HHHHHHHHHHH1HHH4HHHHH", "3HH5HHHHHH82HHHHHHH8H5HH963HHHHHH6HHHHHHHHHHHHHHHH", "6H2H3219H18HH4HHHHHHHHHHHH9HHHHHHHHHHHH8HHHHHHHHHH", "HHHHHHHHHHHHH6HHHHHHHHH3H3HH5HHHH1HHHH61HH182HHHHH", "HHHHHHH66HHH8H2HHHHHHHHHH6HHH4H9H589HHHHHHHHHHHHHH", "HHHH2HHH1HHHHHH72H92H86HH254H2HHHH9H3169HH8HHHHHH9", "HHH4HHH2HH6H67HHHHH95H34HHH6HHHHH85H5H54HH8HH3HHHH", "HHHH3396HHHH618HHHHH2H1HHH5HHHHH69HH6HHHHH2HHHHHH2", "HH9HHHH46HHH4HHHHHH2HHHHH22H3HHH3HHH48HHHHHH8HHHHH", "HHHHHHHHHH4H67H4H61H8742HH39HHHHH796HHHHHHH81HHHHH", "HHHHH967HHHH27HHHHH4HHHHH18HHHHHHHH62HH3HHH9HHHHHH", "9H73H28H4HH851HHHHHH4HHHHH8HHHHH18794H3HHHH62HHHH4", "HHHHHHHHHHHHHH6HHH4H8HHHHHHHHHHHHH5HHH6HHHHHHHHHHH", "HH693HHHHH7HHHHHHHH45HH9H73H49H6HHHH85HHHHH3H7HHHH", "HHHHHHHH3HHHH1HHHHHHHH9H2HHHH2HH39HHH5HHHHHHH8HHH4", "HHH2H831HHHH8975H9HHHHHHHH2HHHHHHHH586HHHHH2HH9HHH", "HH8H154HHHHHHHH7HHH3824HHH8H39HH9HHHH6HHHHHHHHHHHH", "6H43HHH15H5HH3HHHHHHH69HHHH36H7HHH8HH15HHHHHHHHHHH", "HH4HHHH4HHH7HHHHHH6HHHHHH71HHHHHHHHHHHHHHHHHHHHHHH", "HH8H619HHHH2H8H64HHH52HHHHHHHHHHHHHHHHHHHHH2H6HHHH", "HHH8HHH19HH4HHH3HH1H7HHHH9HHH2H14H5HH91HHHH16H5HHH", "HHHHHHHHHHHHHHH5HH66HH5H93HH6HHHHHHHHHHHHHHHHHHHHH", "6H22749HH966H6H734H1HHH6HHHHHHHHH3H82266HHH29HHHHH"});
	}
}
